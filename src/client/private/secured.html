<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<body  ng-app="secured-app">

<div ng-controller="securedctrl">
 
<p>Input something in the input box:</p>
<p>Name: <input type="text" ng-model="name"></p>
<p ng-bind="name"></p>
<button ng-click="list()">List users</button>
<table>
    <tr ng-repeat="u in users">
        <td>{{u.id}}</td>
        <td>{{u.username}}</td>
        <td>{{u.fullname}}</td>
        <td>{{u.email}}</td>
        <td>{{u.password}}</td>
    </tr>
</table>
</div>

<script>
    var app = angular.module("secured-app", []);


  app.config(function($httpProvider) {
    return $httpProvider.interceptors.push("routeUnauthorizedInterceptor");
  });

  app.factory("routeUnauthorizedInterceptor", function($rootScope, $q) {
    return {
      responseError: function(rejection) {
        // Intercept HTTP 401/403 responses
        if (/40(1|3)/.test(rejection.status)) {
          $rootScope.$emit("unauthorized", rejection);
        }
        return $q.reject(rejection);
      }
    };
  });

  app.controller("securedctrl", function($scope, $http, $window, $rootScope){

        $rootScope.$on("unauthorized", function(){
            $window.location.href= "/login.htm";
        });

        $scope.list = function() {
            $http.get("/api/users").then(function(res){
                $scope.users = res.data;
                console.log(res);
            });
        };
    });
</script>

</body>
</html>
